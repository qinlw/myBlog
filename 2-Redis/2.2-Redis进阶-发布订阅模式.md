# Redis进阶

[发布订阅模式](#发布订阅模式)

&emsp;&emsp;[核心概念](#核心概念)

&emsp;&emsp;[基本命令](#基本命令)

&emsp;&emsp;[工作机制](#工作机制)

---

## 发布订阅模式

Redis的发布订阅（Pub/Sub）是一种消息传递机制，允许消息的发布者（Publisher）向频道发送消息，订阅者（Subscriber）监听特定频道接收消息，实现实时通信。

## 核心概念

- 发布者（Publisher）：通过 `publish` 命令向频道发送消息。
- 订阅者（Subscriber）：通过 `subscribe` 或 `psubscribe` 命令订阅一个或多个频道（支持通配符）。
- 频道（Channel）：消息传递的通道，发布者和订阅者通过频道名关联。

## 基本命令

- 订阅一个或多个频道，客户端进入订阅状态，等待接收消息。
	```
		subscribe channel [channel ...]
	```

- 使用通配符订阅频道

	语法 

	```
		psubscribe pattern [pattern ...]
	```

	使用示例：

	```
		psubscribe news.*	// 订阅所有以 "news." 开头的频道
	``` 

	```
		psubscribe chat.?   // 匹配单个字符，订阅如 "chat.8", "chat.k" 的频道
	```

- 向指定频道发送消息，返回接收到消息的订阅者数量。
	```
		publish channel message
	```

- 取消订阅指定频道，若无参数则退订所有频道。
	```
		unsubscribe [channel ...]
	```

- 取消通配符订阅。
	```
		punsubscribe [pattern ...]
	```

## 工作机制

- 订阅模式：客户端执行 `subscribe` 或 `psubscribe` 后，进入阻塞状态，仅能接收订阅相关消息。
- 消息分发：当发布者发送消息时，Redis 遍历所有订阅该频道的客户端，并推送消息。对于通配符订阅，检查频道是否匹配模式。
- 无持久化：消息是即时的，若订阅者不在线，消息会丢失。
- 单线程处理：Redis 单线程执行命令，确保消息顺序性，但高并发时可能影响性能。